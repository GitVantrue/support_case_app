# ì¼€ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

## ê°œìš”

ê³¼ê±° í•´ê²°ëœ AWS Support ì¼€ì´ìŠ¤ë¥¼ ì¼ê´„ì ìœ¼ë¡œ Knowledge Baseì— ì¶”ê°€í•˜ëŠ” ìŠ¤í¬ë¦½íŠ¸ì…ë‹ˆë‹¤.

## ì‹¤í–‰ í™˜ê²½

### ë¡œì»¬ í™˜ê²½ (ì¶”ì²œ)
- Python 3.12+
- AWS CLI ì„¤ì • ì™„ë£Œ (ìê²© ì¦ëª…)
- boto3 ì„¤ì¹˜

### CloudShell (ëŒ€ì•ˆ)
- AWS Consoleì—ì„œ CloudShell ì‹¤í–‰
- íŒŒì¼ ì—…ë¡œë“œ í•„ìš”

## ì‚¬ì „ ì¤€ë¹„

### 1. ì˜ì¡´ì„± ì„¤ì¹˜

```bash
# ë¡œì»¬ í™˜ê²½
pip install boto3

# ë˜ëŠ” requirements.txt ì‚¬ìš©
pip install -r ../lambda/requirements.txt
```

### 2. AWS ìê²© ì¦ëª… í™•ì¸

```bash
# AWS CLI ì„¤ì • í™•ì¸
aws sts get-caller-identity

# ì¶œë ¥ ì˜ˆì‹œ:
# {
#   "UserId": "...",
#   "Account": "370662402529",
#   "Arn": "arn:aws:iam::370662402529:user/..."
# }
```

### 3. IAM ê¶Œí•œ í™•ì¸

í•„ìš”í•œ ê¶Œí•œ:
- `support:DescribeCases`
- `support:DescribeCommunications`
- `bedrock:InvokeModel`
- `s3:PutObject`
- `s3:ListBucket`
- `bedrock-agent:StartIngestionJob` (ì„ íƒì‚¬í•­)

## ì„¤ì •

`migrate_cases.py` íŒŒì¼ ìƒë‹¨ì˜ ì„¤ì • ìˆ˜ì •:

```python
# S3 ë²„í‚· ì´ë¦„
BUCKET_NAME = 'support-knowledge-base-20251204'

# Bedrock KB (ìˆìœ¼ë©´ ì…ë ¥, ì—†ìœ¼ë©´ ë¹ˆ ë¬¸ìì—´)
KB_ID = ''  # ì˜ˆ: 'kb-xxxxxxxxxxxxx'
DS_ID = ''  # ì˜ˆ: 'xxxxxxxxxxxxx'

# ë§ˆì´ê·¸ë ˆì´ì…˜ ê¸°ê°„
START_DATE = '2023-01-01T00:00:00Z'  # ì‹œì‘ ë‚ ì§œ
END_DATE = '2025-12-31T23:59:59Z'    # ì¢…ë£Œ ë‚ ì§œ

# Rate Limit ëŒ€ê¸° ì‹œê°„ (ì´ˆ)
RATE_LIMIT_DELAY = 1  # Bedrock API Rate Limit ë°©ì§€
```

## ì‹¤í–‰ ë°©ë²•

### ë¡œì»¬ì—ì„œ ì‹¤í–‰

```bash
# migration ë””ë ‰í† ë¦¬ë¡œ ì´ë™
cd migration

# ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰
python3 migrate_cases.py
```

### CloudShellì—ì„œ ì‹¤í–‰

1. **íŒŒì¼ ì—…ë¡œë“œ**
   - CloudShell ì—´ê¸°
   - "Actions" â†’ "Upload file"
   - `migrate_cases.py` ì—…ë¡œë“œ
   - `../lambda/process_resolved_case.py` ì—…ë¡œë“œ

2. **ì‹¤í–‰**
   ```bash
   python3 migrate_cases.py
   ```

## ì‹¤í–‰ ê³¼ì •

### 1ë‹¨ê³„: ì¼€ì´ìŠ¤ ëª©ë¡ ì¡°íšŒ
```
ğŸ“‹ í•´ê²°ëœ ì¼€ì´ìŠ¤ ëª©ë¡ ì¡°íšŒ ì¤‘...
   ê¸°ê°„: 2023-01-01T00:00:00Z ~ 2025-12-31T23:59:59Z
   ì¡°íšŒë¨: 100ê°œ (ì´ 100ê°œ)
   ì¡°íšŒë¨: 50ê°œ (ì´ 150ê°œ)

âœ… ì´ 150ê°œì˜ í•´ê²°ëœ ì¼€ì´ìŠ¤ ë°œê²¬
```

### 2ë‹¨ê³„: ê° ì¼€ì´ìŠ¤ ì²˜ë¦¬
```
ì§„í–‰ë¥ : 1/150 (0%)
================================================================================
ğŸ“¦ ì¼€ì´ìŠ¤ ì²˜ë¦¬ ì¤‘: 14424339821
   ì œëª©: MSCK ì¿¼ë¦¬ ê°„í—ì  ì˜¤ë¥˜
   ì¼€ì´ìŠ¤ ID: case-370662402529-muko-2023-8a933541f4bc87c5
   1ï¸âƒ£ S3 ì¤‘ë³µ í™•ì¸ ì¤‘...
   2ï¸âƒ£ ì¼€ì´ìŠ¤ ì •ë³´ ìˆ˜ì§‘ ì¤‘...
   3ï¸âƒ£ Bedrock ìš”ì•½ ìƒì„± ì¤‘...
   4ï¸âƒ£ S3ì— ì €ì¥ ì¤‘...
   âœ… ì„±ê³µ: technical/athena/2025-12/14424339821.json
   â³ 1ì´ˆ ëŒ€ê¸° ì¤‘...
```

### 3ë‹¨ê³„: ê²°ê³¼ ìš”ì•½
```
================================================================================
ğŸ“Š ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ
================================================================================
ì´ ì¼€ì´ìŠ¤ ìˆ˜:    150
âœ… ì„±ê³µ:         145
â­ï¸  ìŠ¤í‚µ:         3
âŒ ì‹¤íŒ¨:         2
================================================================================
```

## ì˜ˆìƒ ì‹¤í–‰ ì‹œê°„

ì¼€ì´ìŠ¤ë‹¹ í‰ê·  15-20ì´ˆ ì†Œìš”:
- ì¼€ì´ìŠ¤ ì •ë³´ ìˆ˜ì§‘: 1-2ì´ˆ
- Bedrock ìš”ì•½: 10-15ì´ˆ
- S3 ì €ì¥: 1ì´ˆ
- Rate Limit ëŒ€ê¸°: 1ì´ˆ

**ì˜ˆìƒ ì‹œê°„**:
- 10ê°œ ì¼€ì´ìŠ¤: ì•½ 3ë¶„
- 50ê°œ ì¼€ì´ìŠ¤: ì•½ 15ë¶„
- 100ê°œ ì¼€ì´ìŠ¤: ì•½ 30ë¶„
- 500ê°œ ì¼€ì´ìŠ¤: ì•½ 2.5ì‹œê°„

## ì¤‘ë‹¨ ë° ì¬ì‹œì‘

### ì¤‘ë‹¨ ë°©ë²•
- `Ctrl+C` í‚¤ë¥¼ ëˆ„ë¥´ë©´ ì•ˆì „í•˜ê²Œ ì¤‘ë‹¨ë©ë‹ˆë‹¤
- í˜„ì¬ê¹Œì§€ì˜ í†µê³„ì™€ ì—ëŸ¬ ë¡œê·¸ê°€ ì €ì¥ë©ë‹ˆë‹¤

### ì¬ì‹œì‘
- ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•˜ë©´ ë©ë‹ˆë‹¤
- ì´ë¯¸ S3ì— ì €ì¥ëœ ì¼€ì´ìŠ¤ëŠ” ìë™ìœ¼ë¡œ ìŠ¤í‚µë©ë‹ˆë‹¤

## ì—ëŸ¬ ì²˜ë¦¬

### ì—ëŸ¬ ë¡œê·¸ íŒŒì¼
ì‹¤íŒ¨í•œ ì¼€ì´ìŠ¤ëŠ” `migration_errors_YYYYMMDD_HHMMSS.json`ì— ì €ì¥ë©ë‹ˆë‹¤:

```json
[
  {
    "case_id": "case-xxx",
    "display_id": "12345",
    "error": "An error occurred..."
  }
]
```

### ì‹¤íŒ¨í•œ ì¼€ì´ìŠ¤ ì¬ì²˜ë¦¬
1. ì—ëŸ¬ ë¡œê·¸ íŒŒì¼ í™•ì¸
2. ì—ëŸ¬ ì›ì¸ íŒŒì•… ë° ìˆ˜ì •
3. ìŠ¤í¬ë¦½íŠ¸ ì¬ì‹¤í–‰ (ìë™ìœ¼ë¡œ ì‹¤íŒ¨í•œ ì¼€ì´ìŠ¤ë§Œ ì¬ì²˜ë¦¬)

## íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ë¬¸ì œ 1: "Access Denied" (Support API)
**ì›ì¸**: Support API ê¶Œí•œ ë¶€ì¡± ë˜ëŠ” Support í”Œëœ ë¶€ì¡±

**í•´ê²°**:
1. IAM ê¶Œí•œ í™•ì¸
2. Business/Enterprise Support í”Œëœ í™•ì¸

### ë¬¸ì œ 2: "Bedrock API í˜¸ì¶œ ì‹¤íŒ¨"
**ì›ì¸**: Bedrock ê¶Œí•œ ë¶€ì¡± ë˜ëŠ” Rate Limit

**í•´ê²°**:
1. IAM ê¶Œí•œ í™•ì¸
2. `RATE_LIMIT_DELAY`ë¥¼ 2-3ì´ˆë¡œ ì¦ê°€

### ë¬¸ì œ 3: "S3 ì €ì¥ ì‹¤íŒ¨"
**ì›ì¸**: S3 ê¶Œí•œ ë¶€ì¡± ë˜ëŠ” ë²„í‚· ì´ë¦„ ì˜¤ë¥˜

**í•´ê²°**:
1. IAM ê¶Œí•œ í™•ì¸
2. `BUCKET_NAME` í™•ì¸

### ë¬¸ì œ 4: ë„ˆë¬´ ëŠë¦¼
**ì›ì¸**: Bedrock API ì‘ë‹µ ì‹œê°„

**í•´ê²°**:
1. ë³‘ë ¬ ì²˜ë¦¬ëŠ” Rate Limit ë•Œë¬¸ì— ê¶Œì¥í•˜ì§€ ì•ŠìŒ
2. ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ ê¶Œì¥:
   ```bash
   nohup python3 migrate_cases.py > migration.log 2>&1 &
   tail -f migration.log
   ```

## ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰ (ì¥ì‹œê°„ ì‹¤í–‰ ì‹œ)

### ë¡œì»¬ í™˜ê²½
```bash
# nohupìœ¼ë¡œ ë°±ê·¸ë¼ìš´ë“œ ì‹¤í–‰
nohup python3 migrate_cases.py > migration.log 2>&1 &

# ì§„í–‰ ìƒí™© í™•ì¸
tail -f migration.log

# í”„ë¡œì„¸ìŠ¤ í™•ì¸
ps aux | grep migrate_cases

# ì¤‘ë‹¨ (í•„ìš” ì‹œ)
kill <PID>
```

### CloudShell
```bash
# screen ì‚¬ìš© (CloudShell ì„¸ì…˜ ì¢…ë£Œ í›„ì—ë„ ê³„ì† ì‹¤í–‰)
screen -S migration
python3 migrate_cases.py

# Detach: Ctrl+A, D
# Reattach: screen -r migration
```

## ì™„ë£Œ í›„ í™•ì¸

### S3 ë²„í‚· í™•ì¸
```bash
# ì €ì¥ëœ íŒŒì¼ ìˆ˜ í™•ì¸
aws s3 ls s3://support-knowledge-base-20251204/ --recursive --region ap-northeast-2 | wc -l

# ì¹´í…Œê³ ë¦¬ë³„ í™•ì¸
aws s3 ls s3://support-knowledge-base-20251204/technical/ --recursive --region ap-northeast-2
aws s3 ls s3://support-knowledge-base-20251204/billing/ --recursive --region ap-northeast-2
```

### Bedrock KB ì¸ë±ì‹± í™•ì¸
```bash
# ì¸ë±ì‹± ì‘ì—… ìƒíƒœ í™•ì¸ (KB_IDê°€ ì„¤ì •ëœ ê²½ìš°)
aws bedrock-agent list-ingestion-jobs \
  --knowledge-base-id <KB_ID> \
  --data-source-id <DS_ID> \
  --region ap-northeast-2
```

## ë‹¤ìŒ ë‹¨ê³„

ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ í›„:
1. âœ… S3 ë²„í‚·ì— ëª¨ë“  ì¼€ì´ìŠ¤ ì €ì¥ í™•ì¸
2. âœ… Bedrock KB ì¸ë±ì‹± ì™„ë£Œ ëŒ€ê¸° (10-30ë¶„)
3. â†’ Slack Botìœ¼ë¡œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸
4. â†’ EventBridge Rule í™œì„±í™”

## ì°¸ê³ 

- ìŠ¤í¬ë¦½íŠ¸ëŠ” Lambda í•¨ìˆ˜ ì½”ë“œë¥¼ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤
- ì¤‘ë³µ ì²˜ë¦¬ ë°©ì§€ ê¸°ëŠ¥ ë‚´ì¥
- Rate Limit ìë™ ì²˜ë¦¬
- ì—ëŸ¬ ë°œìƒ ì‹œ í•´ë‹¹ ì¼€ì´ìŠ¤ë§Œ ìŠ¤í‚µí•˜ê³  ê³„ì† ì§„í–‰
